---
title: "Stripe Integration"
description: "Set up Apple Pay with Stripe."
---

<Warning>
  Apple Pay with Stripe is currently limited to US-based users with Apple Pay enabled, iOS only.
</Warning>

## 1) Set Up Your Stripe Account

A Helium team member will help you create your account if needed, and connect it to Helium's Stripe account.

## 2) Create Stripe Products and Import Them into Helium

Create Stripe products that you would like to show in your paywall.

<Tip>
  For now, we recommend doing distinct Stripe products instead of multiple prices for one product.
</Tip>

Visit your [Products page](https://app.tryhelium.com/integrations/products) and use the Stripe tab to import your Stripe products. Your Stripe products will be placed into their own product buckets, and we recommend keeping them separate from your iOS product buckets.

## 3) Get an Apple Merchant ID

If you do not have one yet, visit the [Apple Developer website](https://developer.apple.com/account/resources/identifiers/list/merchant) to create a Merchant ID.

## 4) Create an Apple Pay Certificate and Share with Stripe

<Note>
  This section is copied directly from [Stripe's Apple Pay guide](https://docs.stripe.com/apple-pay?platform=ios#csr).
</Note>

Go to the [iOS Certificate Settings](https://dashboard.stripe.com/settings/ios_certificates) in the Stripe Dashboard, click **Add new application**, and follow the guide.

Download a Certificate Signing Request (CSR) file to get a secure certificate from Apple that allows you to use Apple Pay.

One CSR file must be used to issue exactly one certificate. If you switch your Apple Merchant ID, you must go to the [iOS Certificate Settings](https://dashboard.stripe.com/settings/ios_certificates) in the Dashboard to obtain a new CSR and certificate.

## 5) App Integration

<Warning>
  In order to show paywalls with Stripe products, you are **required** to set a custom user ID. This ID will be used to grant Stripe entitlements across devices and re-installs.
</Warning>

<Tabs>
  <Tab title="iOS">
    <Note>
      Stripe integration requires Helium **4.1.8+**. If you have not integrated Helium yet, follow the [iOS SDK Quickstart](/sdk/quickstart-ios) first.
    </Note>
    ### Add Apple Pay Capability in Xcode

    In Xcode, open your project settings, click the **Signing & Capabilities** tab, and add the **Apple Pay** capability. Select the merchant ID you created earlier.

    ### Add StripeOneTapPurchase Dependency

    Add this Swift Package dependency:

    ```
    https://github.com/appmonetization/stripe-one-tap-purchase.git
    ```

    ### Modify Your Helium Initialize Call

    Replace `Helium.shared.initialize` with `Helium.shared.initializeWithStripeOneTap`:

    ```swift
    Helium.shared.initializeWithStripeOneTap(
        apiKey: "your-helium-api-key",
        stripePublishableKey: "pk_live_...",
        backupPurchaseDelegate: StoreKitDelegate(), // or RevenueCatDelegate
        merchantIdentifier: "merchant.com.example",
        merchantName: "Your App Name",
        managementURL: URL(string: "https://your-app.com/manage-subscription")!
        // countryCode: "US"   // optional, defaults to "US"
        // currencyCode: "USD"  // optional, defaults to "USD"
    )
    ```

    If the device does not support Apple Pay, the `backupPurchaseDelegate` is used instead (e.g. StoreKit or RevenueCat).

    ### Additional Stripe Functions

    These are available on `Helium.shared` after initializing with Stripe:

    - **`setUserIdAndSyncStripeIfNeeded(userId:)`** — Sets the user ID and syncs Stripe entitlements if needed. Call this instead of setting `Helium.identify.userId` if Helium is already initialized.
    - **`resetStripeEntitlements(clearUserId:)`** — Resets Stripe entitlements and optionally clears the user ID. Use this to "log out" a Stripe user if your app supports multiple Stripe users on the same device.
    - **`createStripePortalSession(returnUrl:)`** — Creates a Stripe Customer Portal session and returns the portal URL. Open this in a browser or in-app webview to let the user manage their subscriptions.

      ```swift
      let portalURL = try await Helium.shared.createStripePortalSession(
          returnUrl: "myapp://settings"
      )
      await UIApplication.shared.open(portalURL)
      ```
    - **`hasActiveStripeEntitlement()`** — Returns `true` if the user has any active Stripe entitlement (e.g. an active subscription).

      ```swift
      let hasEntitlement = await Helium.shared.hasActiveStripeEntitlement()
      ```
  </Tab>
  <Tab title="React Native">
    <Note>
      Stripe integration requires expo-helium **3.2.8+**. If you have not integrated Helium yet, follow the [React Native SDK Quickstart](/sdk/quickstart-react-native) first.
    </Note>
    <Warning>
      Stripe One Tap is iOS only. On Android, Helium will continue to use standard initialization.
    </Warning>
    ### Install Packages

    ```bash
    npm install expo-helium@latest expo-helium-stripe
    ```

    ### Add Apple Pay Entitlement

    Add the Apple Pay entitlement to your `app.json` (or `app.config.js`):

    ```json
    {
      "expo": {
        "ios": {
          "entitlements": {
            "com.apple.developer.in-app-payments": [
              "merchant.your-merchant-identifier"
            ]
          }
        }
      }
    }
    ```

    The merchant identifier here should be the same Apple Merchant ID you created in [Step 3](#3-get-an-apple-merchant-id) above.

    ### Update Your Initialization Code

    Replace `initialize` from `expo-helium` with `initializeWithStripe` from `expo-helium-stripe`:

    ```typescript
    // Before
    import { initialize } from 'expo-helium';
    await initialize({ apiKey: '...', ... });
    
    // After
    import { initializeWithStripe } from 'expo-helium-stripe';
    await initializeWithStripe({
      apiKey: '...',
      stripePublishableKey: '...',
      merchantIdentifier: 'merchant.your-merchant-identifier',
      merchantName: 'Your App Name',
      managementURL: 'https://your-app.com/manage-subscription',
      // countryCode: 'US',   // optional, defaults to "US"
      // currencyCode: 'USD',  // optional, defaults to "USD"
      // ...all existing HeliumConfig options still work
    });
    ```

    All other imports (`presentUpsell`, `hasEntitlementForPaywall`, `resetHelium`, etc.) still come from `expo-helium` — only the initialization changes.

    ### Additional Stripe Functions

    The following functions are available from `expo-helium-stripe` (iOS only):

    - `setUserIdAndSyncStripeIfNeeded(userId)` — Sets the user ID and syncs Stripe entitlements if needed. Call this instead of `setCustomUserId`.
    - `resetStripeEntitlements(clearUserId?)` — Resets Stripe entitlements and optionally clears the user ID. Use this to "log out" a Stripe user if your app supports multiple Stripe users on the same device.
    - `await createStripePortalSession(returnUrl)` — Creates a Stripe Customer Portal session and returns the portal URL. Open this in a browser or in-app webview to let the user manage their subscriptions.
    - `await hasActiveStripeEntitlement()` — Returns `true` if the user has any active Stripe entitlement (e.g. an active subscription).
  </Tab>
</Tabs>

## Checking Entitlements

The Helium SDK provides entitlement helper methods that work with Stripe purchases. See the entitlements section in the [iOS Quickstart](/sdk/quickstart-ios#checking-subscription-status--entitlements) or [React Native Quickstart](/sdk/quickstart-react-native#checking-subscription-status--entitlements) for the full API reference.

<Warning>
  On iOS, some entitlement methods (e.g. `hasActiveSubscriptionFor(subscriptionGroupID:)`, `subscriptionStatusFor(...)`, `activeSubscriptions()`) rely on StoreKit and will **not** reflect Stripe purchases. For Stripe, use `hasEntitlementForPaywall(trigger:)`, `hasActiveEntitlementFor(productId:)`, `hasAnyActiveSubscription()`, and `hasAny()` instead.
</Warning>

## RevenueCat + Stripe

If you use [RevenueCat alongside Stripe](https://www.revenuecat.com/docs/web/integrations/stripe), follow these additional steps so that RevenueCat will be able to track entitlements for Stripe purchases:

1. Visit your [RevenueCat Account Settings](https://app.revenuecat.com/settings/account) and find the **Connect Stripe** button
2. Install the Revenue Cat app to your Stripe account
3. Open [RevenueCat dashboard](https://app.revenuecat.com/overview) \> Select your project \> Apps & providers \> Add web config \> Find your Stripe account and select it, complete the flow
4. Select the Stripe web configuration you just added and configure [Stripe webhooks to send to RevenueCat](https://www.revenuecat.com/docs/platform-resources/server-notifications/stripe-server-notifications). Make sure to include these events:
   1. customer.subscription.updated
   2. customer.subscription.deleted
   3. charge.refunded
   4. invoice.updated
   5. customer.subscription.created
   6. checkout.session.completed
1. Enable **Track new purchases from server-to-server notifications** and enter **rc_user_id** as the Metadata field key:

   <Frame>
     ![Screenshot 2026 02 26 At 7 20 29 PM](/images/Screenshot2026-02-26at7.20.29PM.png)
   </Frame>
6. Configure your Stripe products with RevenueCat:
   1. Visit **Product catalog** for your desired project in RevenueCat dashboard.
   2. In the Products tab, find the Stripe section and add Stripe products
   3. Go to Entitlements tab, select desired entitlement/s, click Attach and add the Stripe products you just created
   4. If you rely on Offerings in your RevenueCat integration, you can also add the Stripe products there