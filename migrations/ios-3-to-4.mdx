---
title: "iOS: Migrating from v3 to v4"
description: "Migration guide for Helium iOS SDK v4"
icon: "arrow-up-right-from-square"
---

<Warning>
**Breaking Changes in v4:**
- `presentUpsell()` renamed to `presentPaywall()` with required `onPaywallNotShown` handler
- `dontShowIfAlreadyEntitled` now defaults to `true`
- Initialize parameters moved to `Helium.identify` and `Helium.config` namespaces
- Fallback views removed - use fallback bundles only
</Warning>

<Info>
**What's New:**
- Simplified `initialize()` - just pass your API key
- New `HeliumPaywall` SwiftUI component for embedded paywalls
- Automatic fallback bundle detection (`helium-fallbacks.json`)
- Cleaner namespaced APIs: `Helium.identify`, `Helium.config`, `Helium.experiments`, `Helium.entitlements`
</Info>

## Installation Update

Update your version constraint to `~> 4.0`:

<Tabs>
  <Tab title="Swift Package Manager">
    Update the **Dependency Rule** in Xcode to allow 4.x versions, or remove and re-add the package with the new version constraint.
  </Tab>
  <Tab title="Cocoapods">
    Update your Podfile:

    ```ruby
    # Core only
    pod 'Helium', '~> 4.0'

    # Or with RevenueCat
    pod 'Helium/RevenueCat', '~> 4.0'
    ```

    Then run:

    ```bash
    pod install
    ```
  </Tab>
</Tabs>

## Initialize Migration

The biggest change in v4 is the simplified initialization. Configuration that was previously passed to `initialize()` is now set on dedicated namespaces beforehand.

**v3 (many parameters):**

```swift
Helium.shared.initialize(
    apiKey: "...",
    heliumPaywallDelegate: RevenueCatDelegate(),
    customUserId: "user-123",
    customUserTraits: HeliumUserTraits(["plan": "free"]),
    fallbackConfig: .withFallbackBundle(bundleURL)
)
```

**v4 (simplified):**

```swift
// Configure before initialize
Helium.identify.userId = "user-123"
Helium.identify.setUserTraits(HeliumUserTraits(["plan": "free"]))
Helium.config.purchaseDelegate = RevenueCatDelegate()

// Initialize with just API key
Helium.shared.initialize(apiKey: "...")
```

<Tip>
  Set identity and configuration values **before** calling `initialize()` for best results.
</Tip>

## presentUpsell to presentPaywall

The method has been renamed and now requires an `onPaywallNotShown` handler.

<CodeGroup>

```swift v3
Helium.shared.presentUpsell(trigger: "premium")
```

```swift v4
Helium.shared.presentPaywall(trigger: "premium") { reason in
    // handle paywall not shown
}
```

</CodeGroup>

### Full Example with All Parameters

**v3:**

```swift
Helium.shared.presentUpsell(
    trigger: "premium",
    presentFromViewController: viewController,
    customPaywallTraits: ["source": "settings"],
    dontShowIfAlreadyEntitled: true,
    eventHandlers: PaywallEventHandlers()
        .onPurchaseSucceeded { event in
            print("Purchased!")
        }
)
```

**v4:**

```swift
Helium.shared.presentPaywall(
    trigger: "premium",
    config: PaywallPresentationConfig(
        presentFromViewController: viewController,
        customPaywallTraits: ["source": "settings"],
        dontShowIfAlreadyEntitled: true
    ),
    eventHandlers: PaywallEventHandlers()
        .onPurchaseSucceeded { event in
            print("Purchased!")
        },
    onEntitled: {
        // User is now entitled (purchased or restored)
    }
) { paywallNotShownReason in
    switch paywallNotShownReason {
    case .targetingHoldout:
        break
    case .alreadyEntitled:
        // User already has access
        break
    default:
        // Handle rare failure cases
        break
    }
}
```

<Note>
  `dontShowIfAlreadyEntitled` now defaults to `true` in v4. Set it to `false` explicitly if you want to show paywalls to entitled users.
</Note>

## API Namespace Migration

### Helium.identify

| v3 | v4 |
|---|---|
| `initialize(customUserId:)` | `Helium.identify.userId = ...` |
| `overrideUserId()` | `Helium.identify.userId = ...` |
| `getHeliumUserId()` | `Helium.identify.userId` |
| `setAppAttributionToken()` | `Helium.identify.appAccountToken = ...` |
| `setRevenueCatAppUserId()` | `Helium.identify.revenueCatAppUserId = ...` |

<CodeGroup>

```swift v3
Helium.shared.overrideUserId("user-123")
let userId = Helium.shared.getHeliumUserId()
Helium.shared.setAppAttributionToken(uuid)
Helium.shared.setRevenueCatAppUserId(rcUserId)
```

```swift v4
Helium.identify.userId = "user-123"
let userId = Helium.identify.userId
Helium.identify.appAccountToken = uuid
Helium.identify.revenueCatAppUserId = rcUserId
```

</CodeGroup>

### Helium.config

| v3 | v4 |
|---|---|
| `initialize(heliumPaywallDelegate:)` | `Helium.config.purchaseDelegate = ...` |
| `setLightDarkModeOverride()` | `Helium.config.lightDarkModeOverride = ...` |
| `Helium.restorePurchaseConfig` | `Helium.config.restorePurchasesDialog` |

<CodeGroup>

```swift v3
Helium.shared.initialize(
    apiKey: "...",
    heliumPaywallDelegate: RevenueCatDelegate()
)
Helium.shared.setLightDarkModeOverride(.dark)
Helium.restorePurchaseConfig.useCustomRestoreLogic = true
```

```swift v4
Helium.config.purchaseDelegate = RevenueCatDelegate()
Helium.config.lightDarkModeOverride = .dark
Helium.config.restorePurchasesDialog.useCustomRestoreLogic = true
Helium.shared.initialize(apiKey: "...")
```

</CodeGroup>

### Helium.experiments

| v3 | v4 |
|---|---|
| `getExperimentInfoForTrigger()` | `Helium.experiments.infoForTrigger()` |
| `enrolledExperiments()` | `Helium.experiments.enrolled()` |
| `allExperiments()` | `Helium.experiments.all()` |

<CodeGroup>

```swift v3
let info = Helium.shared.getExperimentInfoForTrigger("premium")
let enrolled = Helium.shared.enrolledExperiments()
let all = Helium.shared.allExperiments()
```

```swift v4
let info = Helium.experiments.infoForTrigger("premium")
let enrolled = Helium.experiments.enrolled()
let all = Helium.experiments.all()
```

</CodeGroup>

### Helium.entitlements

| v3 | v4 |
|---|---|
| `hasAnyEntitlement()` | `Helium.entitlements.hasAny()` |
| `hasAnyActiveSubscription()` | `Helium.entitlements.hasAnyActiveSubscription()` |
| `hasEntitlementForPaywall()` | `Helium.entitlements.hasForPaywall()` |
| `hasActiveEntitlementFor()` | `Helium.entitlements.hasActiveFor()` |
| `purchasedProductIds()` | `Helium.entitlements.purchasedProductIds()` |
| `activeSubscriptions()` | `Helium.entitlements.activeSubscriptions()` |

<CodeGroup>

```swift v3
let hasAny = await Helium.shared.hasAnyEntitlement()
let hasSub = await Helium.shared.hasAnyActiveSubscription()
let products = await Helium.shared.purchasedProductIds()
```

```swift v4
let hasAny = await Helium.entitlements.hasAny()
let hasSub = await Helium.entitlements.hasAnyActiveSubscription()
let products = await Helium.entitlements.purchasedProductIds()
```

</CodeGroup>

## Fallback Changes

v4 removes fallback views and simplifies fallback configuration.

### What's Changed

- **No more fallback views** - Use fallback bundles exclusively
- **Automatic detection** - SDK auto-detects `helium-fallbacks.json` in your main bundle
- **Optional override** - Use `Helium.config.customFallbacksURL` if needed

### Migration

**v3:**

```swift
let fallbackConfig = HeliumFallbackConfig(
    fallbackView: YourFallbackView(),
    fallbackBundle: Bundle.main.url(
        forResource: "fallback-bundle",
        withExtension: "json"
    )
)

Helium.shared.initialize(
    apiKey: "...",
    fallbackConfig: fallbackConfig
)
```

**v4:**

```swift
// Option 1: Automatic (recommended)
// Just add helium-fallbacks.json to your bundle - SDK finds it automatically

// Option 2: Custom location
Helium.config.customFallbacksURL = Bundle.main.url(
    forResource: "my-fallbacks",
    withExtension: "json"
)

Helium.shared.initialize(apiKey: "...")
```

<Info>
  Download your fallback bundle from the Helium dashboard. See the [Fallback Bundle Guide](/guides/fallback-bundle) for details.
</Info>

## Embedded Paywall Views

The SwiftUI view for embedding paywalls has been replaced.

<CodeGroup>

```swift v3 (deprecated)
let paywallView = Helium.shared.upsellViewForTrigger("premium")
```

```swift v4
HeliumPaywall(
    trigger: "premium",
    onPaywallNotShown: { reason in
        // Handle paywall not shown
    }
)
```

</CodeGroup>

### Full Example

```swift
struct PremiumView: View {
    var body: some View {
        HeliumPaywall(
            trigger: "premium",
            config: PaywallPresentationConfig(
                customPaywallTraits: ["source": "settings"]
            ),
            eventHandlers: PaywallEventHandlers()
                .onPurchaseSucceeded { _ in
                    print("Purchased!")
                },
            onEntitled: {
                // Dismiss or update UI
            },
            onPaywallNotShown: { reason in
                // Show alternative content
            }
        )
    }
}
```

## Removed APIs

The following APIs have been removed in v4:

| Removed API | Replacement |
|---|---|
| `getHeliumExperimentInfo()` (map version) | `Helium.experiments.all()` |
| `loadingStateEnabledFor()` | Loading handled automatically |
| `HeliumFallbackConfig` class | Use `Helium.config.customFallbacksURL` |
| All `fallback*` parameters from initialize | Add `helium-fallbacks.json` to bundle |
| `upsellViewForTrigger()` | `HeliumPaywall` component |

## Quick Migration Checklist

Use this checklist to ensure you've covered all migration steps:

- [ ] Update SDK to 4.x (`~> 4.0`)
- [ ] Move user ID/traits to `Helium.identify.*` before `initialize()`
- [ ] Move delegate/config to `Helium.config.*` before `initialize()`
- [ ] Replace `presentUpsell()` with `presentPaywall()` and add required handler
- [ ] Set up fallback bundle (download from dashboard, add as `helium-fallbacks.json`)
- [ ] Update experiment calls to `Helium.experiments.*`
- [ ] Update entitlement calls to `Helium.entitlements.*`
- [ ] Replace `upsellViewForTrigger()` with `HeliumPaywall` component
- [ ] Test paywall presentation and purchases

## Need Help?

- Review the [iOS SDK Quickstart](/sdk/quickstart-ios)
- See the [Complete Example App](https://github.com/cloudcaptainai/example-helium-swift) on GitHub
- Contact support via Slack or [founders@tryhelium.com](mailto:founders@tryhelium.com)
