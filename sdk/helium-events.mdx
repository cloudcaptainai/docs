---
title: "Helium Events"
description: "Understanding Helium SDK Events"
icon: "bolt"
---

## Overview

The Helium SDK v2 introduces a typed event system that provides type-safe, protocol-based events for better IDE support and cleaner code. The new system offers strongly-typed event structs, better autocomplete, and full backward compatibility during migration.

## Event Types

### Core Event Protocols

```swift
// Base protocol for all events
protocol PaywallEvent {
    var eventName: String { get }
    var timestamp: Date { get }
    func toDictionary() -> [String: Any]
}

// Events with paywall context
protocol PaywallContextEvent: PaywallEvent {
    var triggerName: String { get }
    var paywallName: String { get }
}

// Product-related events
protocol ProductEvent: PaywallContextEvent {
    var productId: String { get }
}
```

## Listening to Events

### Method 1: Via Delegate (Recommended)

Implement the `HeliumPaywallDelegate` protocol with the `onPaywallEvent(_:)` method:

```swift
class MyPaywallDelegate: HeliumPaywallDelegate {
    
    func makePurchase(productId: String) async -> HeliumPaywallTransactionStatus {
        // Your purchase implementation
        return .purchased
    }
    
    func restorePurchases() async -> Bool {
        // Your restore implementation
        return false
    }
    
    func onPaywallEvent(_ event: PaywallEvent) {
        // Type-safe event handling with pattern matching
        switch event {
        case let openEvent as PaywallOpenEvent:
            print("Paywall opened: \(openEvent.paywallName)")
            print("Trigger: \(openEvent.triggerName)")
            print("View type: \(openEvent.viewType)")
            analytics.track("paywall_open", properties: openEvent.toDictionary())
            
        case let purchaseSuccess as PurchaseSucceededEvent:
            print("Purchase successful: \(purchaseSuccess.productId)")
            updateUserSubscription(purchaseSuccess.productId)
            
        case let purchaseFailed as PurchaseFailedEvent:
            if let error = purchaseFailed.error {
                print("Purchase failed: \(error.localizedDescription)")
                showErrorAlert(error)
            }
            
        case let dismissed as PaywallDismissedEvent:
            print("User dismissed paywall")
            if dismissed.dismissAll {
                print("All paywalls dismissed")
            }
            
        case let closeEvent as PaywallCloseEvent:
            print("Paywall closed")
            // Cleanup code here
            
        default:
            print("Event: \(event.eventName)")
        }
    }
}
```

### Method 2: Via PaywallEventService (for triggerUpsell)

Use the `PaywallEventService` with a builder pattern for inline event handling:

```swift
struct ContentView: View {
    @State private var showPaywall = false
    
    var body: some View {
        Button("Show Premium Features") {
            showPaywall = true
        }
        .triggerUpsell(
            isPresented: $showPaywall,
            trigger: "premium_upgrade",
            eventService: PaywallEventService()
                .onOpen { event in
                    print("Paywall opened at \(event.timestamp)")
                    analytics.track("paywall_impression", [
                        "trigger": event.triggerName,
                        "paywall": event.paywallName,
                        "viewType": event.viewType.rawValue
                    ])
                }
                .onDismissed { event in
                    print("User dismissed without purchasing")
                    analytics.track("paywall_dismissed", [
                        "trigger": event.triggerName
                    ])
                }
                .onPurchaseSucceeded { event in
                    print("Purchase successful: \(event.productId)")
                    userDefaults.set(true, forKey: "isPremium")
                    showSuccessMessage()
                }
                .onClose { event in
                    print("Paywall closed, cleanup resources")
                    resetPaywallState()
                },
            customPaywallTraits: [
                "user_level": getCurrentUserLevel(),
                "session_duration": getSessionDuration(),
                "feature_attempted": "advanced_filters"
            ]
        )
    }
}
```

### Method 3: Programmatic Presentation with Events

```swift
// UIKit example with event service
func showPaywall() {
    let eventService = PaywallEventService()
        .onOpen { event in
            logEvent("paywall_shown", event.toDictionary())
        }
        .onPurchaseSucceeded { event in
            handleSuccessfulPurchase(event.productId)
        }
        .onClose { event in
            cleanupPaywallResources()
        }
    
    Helium.shared.presentUpsell(
        trigger: "premium_feature",
        from: self,
        eventService: eventService,
        customPaywallTraits: [
            "source": "settings_menu",
            "user_tier": "free",
            "days_since_install": 7
        ]
    )
}
```

## Available Events

### Lifecycle Events

#### PaywallOpenEvent
Paywall displayed to user.

```swift
let event: PaywallOpenEvent
// Properties:
event.triggerName     // Trigger identifier from dashboard
event.paywallName     // Template name
event.viewType        // .presented, .triggered, or .embedded
event.timestamp       // When event occurred
```

#### PaywallCloseEvent
Paywall closed (any reason).

```swift
let event: PaywallCloseEvent
event.triggerName     // Associated trigger
event.paywallName     // Template that was closed
event.timestamp       // When closed
```

#### PaywallDismissedEvent
User explicitly dismissed.

```swift
let event: PaywallDismissedEvent
event.triggerName     // Dismissed paywall trigger
event.paywallName     // Dismissed template
event.dismissAll      // Whether entire stack dismissed
event.timestamp       // Dismissal time
```

#### PaywallOpenFailedEvent
Failed to open paywall.

```swift
let event: PaywallOpenFailedEvent
event.triggerName     // Trigger that failed
event.paywallName     // Template that failed to open
event.timestamp       // Failure time
```

#### PaywallSkippedEvent
Paywall skipped (shouldShow=false).

```swift
let event: PaywallSkippedEvent
event.triggerName     // Trigger that was skipped
event.timestamp       // When skipped
```

#### PaywallButtonPressedEvent
Non-purchase button pressed.

```swift
let event: PaywallButtonPressedEvent
event.buttonName      // Button identifier
event.triggerName     // Associated trigger
event.paywallName     // Template containing button
event.timestamp       // Press time
```

#### PaywallWebViewRenderedEvent
WebView finished rendering.

```swift
let event: PaywallWebViewRenderedEvent
event.triggerName     // Associated trigger
event.paywallName     // Template rendered
event.renderTime      // Time to render (ms)
event.timestamp       // Completion time
```

### Purchase Events

#### ProductSelectedEvent
User selected a product.

```swift
let event: ProductSelectedEvent
event.productId       // StoreKit product ID
event.triggerName     // Associated trigger
event.paywallName     // Template where selected
event.timestamp       // Selection time
```

#### PurchasePressedEvent
Purchase initiated.

```swift
let event: PurchasePressedEvent
event.productId       // Product being purchased
event.triggerName     // Associated trigger
event.paywallName     // Template where pressed
event.timestamp       // Press time
```

#### PurchaseSucceededEvent
Purchase completed.

```swift
let event: PurchaseSucceededEvent
event.productId       // StoreKit product ID
event.triggerName     // Associated trigger
event.paywallName     // Template where purchased
event.timestamp       // Completion time
```

#### PurchaseCancelledEvent
User cancelled purchase.

```swift
let event: PurchaseCancelledEvent
event.productId       // Product that was cancelled
event.triggerName     // Associated trigger
event.paywallName     // Template where cancelled
event.timestamp       // Cancellation time
```

#### PurchaseFailedEvent
Purchase failed with error.

```swift
let event: PurchaseFailedEvent
event.productId       // Product that failed
event.triggerName     // Associated trigger
event.paywallName     // Template where failed
event.error           // StoreKit error object
event.timestamp       // Failure time
```

#### PurchaseRestoredEvent
Previous purchase restored.

```swift
let event: PurchaseRestoredEvent
event.productId       // Restored product ID
event.triggerName     // Associated trigger
event.paywallName     // Template where restored
event.timestamp       // Restoration time
```

#### PurchaseRestoreFailedEvent
Restore failed.

```swift
let event: PurchaseRestoreFailedEvent
event.triggerName     // Associated trigger
event.paywallName     // Template where failed
event.timestamp       // Failure time
```

#### PurchasePendingEvent
Purchase pending (e.g., parental approval).

```swift
let event: PurchasePendingEvent
event.productId       // Pending product
event.triggerName     // Associated trigger
event.paywallName     // Template where pending
event.timestamp       // When became pending
```

### System Events

#### InitializeStartEvent
SDK initialization started.

```swift
let event: InitializeStartEvent
event.timestamp       // Start time
```

#### PaywallsDownloadSuccessEvent
Config downloaded successfully.

```swift
let event: PaywallsDownloadSuccessEvent
event.downloadTime    // Total download time (ms)
event.numAttempts     // Number of attempts made
event.timestamp       // Success time
```

#### PaywallsDownloadErrorEvent
Config download failed.

```swift
let event: PaywallsDownloadErrorEvent
event.error           // Error description
event.numAttempts     // Attempts made
event.timestamp       // Failure time
```

## Custom Paywall Traits

Pass dynamic context to paywalls at presentation time:

```swift
// Set during presentation
.triggerUpsell(
    isPresented: $showPaywall,
    trigger: "game_over",
    customPaywallTraits: [
        "final_score": gameState.score,
        "level": gameState.currentLevel,
        "lives_remaining": gameState.lives,
        "high_score": userStats.bestScore,
        "session_length": Date().timeIntervalSince(sessionStart)
    ]
)

// Access in JavaScript within paywall template
const score = window.heliumContext.final_score;
const level = window.heliumContext.level;
```

## Event Handling Notes

- `onDismissed` fires when user explicitly closes without purchasing
- `onClose` fires after both dismissal and successful purchase for cleanup
- Custom traits are cleared automatically when paywall closes
- Protocol conformance enables handling groups of related events

## Using Events for Analytics

Leverage protocol conformance for efficient analytics:

```swift
func onPaywallEvent(_ event: PaywallEvent) {
    // Log all events
    analytics.track(event.eventName, properties: event.toDictionary())
    
    // Handle all events with paywall context
    if let contextEvent = event as? PaywallContextEvent {
        trackPaywallMetrics(
            trigger: contextEvent.triggerName,
            paywall: contextEvent.paywallName
        )
    }
    
    // Handle all product-related events
    if let productEvent = event as? ProductEvent {
        validateProduct(productId: productEvent.productId)
    }
}
```

## Performance Monitoring

Several events include timing information for performance monitoring:

- `PaywallsDownloadSuccessEvent` - Configuration download times
- `PaywallWebViewRenderedEvent` - WebView render times

Use this data to identify bottlenecks and optimize user experience.

---

# Migration Guide: v1 to v2 Events

## Overview

The v2 event system provides:
- **Type safety** with strongly-typed event structs
- **Better IDE support** with autocomplete for event properties
- **Cleaner code** without massive switch statements
- **Full backward compatibility** during migration

## Key Changes

### 1. Event Structure
- **v1**: Single enum with associated values
- **v2**: Individual structs conforming to `PaywallEvent` protocol

### 2. Property Names
- `paywallTemplateName` → `paywallName`
- `productKey` → `productId`
- All `subscription*` events → `purchase*` events
- Removed `ctaPressed` event
- Removed `configId` from download success events
- `error` is now `Error` type instead of `String`

### 3. Delegate Methods
- **v1**: `onHeliumPaywallEvent(event:)` (deprecated)
- **v2**: `onPaywallEvent(_:)` (recommended)

## Migration Steps

### Step 1: Update Your Delegate Implementation

#### Before (v1):
```swift
class MyPaywallDelegate: HeliumPaywallDelegate {
    func onHeliumPaywallEvent(event: HeliumPaywallEvent) {
        switch event {
        case .paywallOpen(let trigger, let template, let viewType):
            print("Paywall opened: \(template)")
            analytics.track("paywall_open", properties: [
                "trigger": trigger,
                "template": template,
                "viewType": viewType
            ])
            
        case .subscriptionSucceeded(let productKey, let trigger, let template):
            print("Subscription successful: \(productKey)")
            updateSubscription(productKey)
            
        case .subscriptionFailed(let productKey, let trigger, let template, let error):
            if let error = error {
                showError(error)
            }
            
        default:
            break
        }
    }
}
```

#### After (v2):
```swift
class MyPaywallDelegate: HeliumPaywallDelegate {
    func onPaywallEvent(_ event: PaywallEvent) {
        // Type-safe event handling
        switch event {
        case let openEvent as PaywallOpenEvent:
            print("Paywall opened: \(openEvent.paywallName)")
            analytics.track("paywall_open", properties: openEvent.toDictionary())
            
        case let successEvent as PurchaseSucceededEvent:
            print("Purchase successful: \(successEvent.productId)")
            updateSubscription(successEvent.productId)
            
        case let failedEvent as PurchaseFailedEvent:
            if let error = failedEvent.error {
                showError(error.localizedDescription)
            }
            
        default:
            break
        }
    }
    
    // Remove the old method once migration is complete
    // func onHeliumPaywallEvent(event: HeliumPaywallEvent) { }
}
```

## Event Mapping Reference

| v1 Event | v2 Event | Changes |
|----------|----------|---------|
| `.paywallOpen(triggerName, paywallTemplateName, viewType)` | `PaywallOpenEvent` | `paywallTemplateName` → `paywallName` |
| `.paywallClose(triggerName, paywallTemplateName)` | `PaywallCloseEvent` | `paywallTemplateName` → `paywallName` |
| `.subscriptionPressed(productKey, triggerName, paywallTemplateName)` | `PurchasePressedEvent` | `productKey` → `productId`, event renamed |
| `.subscriptionSucceeded(productKey, triggerName, paywallTemplateName)` | `PurchaseSucceededEvent` | `productKey` → `productId`, event renamed |
| `.subscriptionFailed(productKey, triggerName, paywallTemplateName, error)` | `PurchaseFailedEvent` | `error: String?` → `error: Error?`, event renamed |
| `.subscriptionCancelled(productKey, triggerName, paywallTemplateName)` | `PurchaseCancelledEvent` | Event renamed |
| `.subscriptionRestored(productKey, triggerName, paywallTemplateName)` | `PurchaseRestoredEvent` | Event renamed |
| `.subscriptionPending(productKey, triggerName, paywallTemplateName)` | `PurchasePendingEvent` | Event renamed |
| `.paywallDismissed(triggerName, paywallTemplateName, dismissAll)` | `PaywallDismissedEvent` | `paywallTemplateName` → `paywallName` |
| `.paywallOpenFailed(triggerName, paywallTemplateName)` | `PaywallOpenFailedEvent` | `paywallTemplateName` → `paywallName` |
| `.paywallSkipped(triggerName)` | `PaywallSkippedEvent` | No changes |
| `.paywallsDownloadSuccess(configId, ...)` | `PaywallsDownloadSuccessEvent` | Removed `configId` |
| `.paywallsDownloadError(error, numAttempts)` | `PaywallsDownloadErrorEvent` | No changes |
| `.paywallWebViewRendered(...)` | `PaywallWebViewRenderedEvent` | `paywallTemplateName` → `paywallName` |
| `.ctaPressed(...)` | **Removed** | No longer supported |
| `.initializeStart` | `InitializeStartEvent` | No changes |
| `.offerSelected(productKey, triggerName, paywallTemplateName)` | `ProductSelectedEvent` | Event renamed |
| `.subscriptionRestoreFailed(triggerName, paywallTemplateName)` | `PurchaseRestoreFailedEvent` | Event renamed |

## Gradual Migration

The SDK supports both event systems simultaneously:

1. **Phase 1**: Implement the new `onPaywallEvent(_:)` method alongside your existing `onHeliumPaywallEvent(event:)`
2. **Phase 2**: Test and verify the new implementation
3. **Phase 3**: Remove the old `onHeliumPaywallEvent(event:)` method

**Important**: During migration, both methods may be called. Implement your logic in only one method to avoid duplicate handling.

## Benefits After Migration

- **Compile-time safety**: Catch event property typos at compile time
- **Better autocomplete**: IDE knows all available properties
- **Cleaner code**: No complex switch statements to extract values
- **Easier testing**: Create test events without dealing with enum syntax
- **Future-proof**: New events are just new structs, no enum modifications

## Complete Migration Example

```swift
class ModernPaywallDelegate: HeliumPaywallDelegate {
    
    func makePurchase(productId: String) async -> HeliumPaywallTransactionStatus {
        // Your implementation
        return .purchased
    }
    
    func restorePurchases() async -> Bool {
        return false
    }
    
    func onPaywallEvent(_ event: PaywallEvent) {
        // Log all events
        logger.log(event.eventName, metadata: event.toDictionary())
        
        // Handle specific events with type safety
        switch event {
        case let open as PaywallOpenEvent:
            handlePaywallOpen(open)
            
        case let success as PurchaseSucceededEvent:
            handlePurchaseSuccess(success)
            
        case let failed as PurchaseFailedEvent:
            handlePurchaseFailure(failed)
            
        default:
            // Handle other events or ignore
            break
        }
    }
    
    private func handlePaywallOpen(_ event: PaywallOpenEvent) {
        // Direct property access - no unwrapping needed
        analytics.track("paywall_open", [
            "trigger": event.triggerName,
            "paywall": event.paywallName,
            "viewType": event.viewType.rawValue,
            "timestamp": event.timestamp
        ])
    }
    
    private func handlePurchaseSuccess(_ event: PurchaseSucceededEvent) {
        // Type-safe access to all properties
        userDefaults.set(event.productId, forKey: "active_subscription")
        notificationCenter.post(
            name: .subscriptionActivated,
            object: nil,
            userInfo: ["productId": event.productId]
        )
    }
    
    private func handlePurchaseFailure(_ event: PurchaseFailedEvent) {
        // Error is now a proper Error object
        if let error = event.error {
            errorReporter.report(error, context: [
                "productId": event.productId,
                "trigger": event.triggerName
            ])
        }
    }
}
```

---

# Legacy v1 Event Reference

<Note>
The following section documents the legacy v1 event system. For new implementations, use the v2 event system described above.
</Note>

## Legacy Event Handling

The v1 system uses the `onHeliumPaywallEvent` method with an enum-based approach:

```swift
func onHeliumPaywallEvent(event: HeliumPaywallEvent) {
    switch (event) {
    case .paywallOpen(let triggerName, let paywallTemplateName, let viewType):
        print("Paywall opened: \(triggerName), template: \(paywallTemplateName), viewType: \(viewType)")
    case .subscriptionSucceeded(let productKey, let triggerName, let paywallTemplateName):
        print("Subscription succeeded for product: \(productKey)")
    // Handle other events as needed
    default:
        break
    }
}
```

## Legacy Event Categories

### Initialization Events

#### Initialize Start
```swift
case initializeStart
```

### User Interaction Events

#### CTA Pressed (Removed in v2)
```swift
case ctaPressed(ctaName: String, triggerName: String, paywallTemplateName: String)
```

#### Offer Selected
```swift
case offerSelected(productKey: String, triggerName: String, paywallTemplateName: String)
```

#### Subscription Pressed
```swift
case subscriptionPressed(productKey: String, triggerName: String, paywallTemplateName: String)
```

### Subscription Status Events

#### Subscription Cancelled
```swift
case subscriptionCancelled(productKey: String, triggerName: String, paywallTemplateName: String)
```

#### Subscription Succeeded
```swift
case subscriptionSucceeded(productKey: String, triggerName: String, paywallTemplateName: String)
```

#### Subscription Failed
```swift
case subscriptionFailed(productKey: String, triggerName: String, paywallTemplateName: String, error: String? = nil)
```

#### Subscription Restored
```swift
case subscriptionRestored(productKey: String, triggerName: String, paywallTemplateName: String)
```

#### Subscription Restore Failed
```swift
subscriptionRestoreFailed(triggerName: String, paywallTemplateName: String)
```

#### Subscription Pending
```swift
case subscriptionPending(productKey: String, triggerName: String, paywallTemplateName: String)
```

### Paywall Lifecycle Events

#### Paywall Open
```swift
case paywallOpen(triggerName: String, paywallTemplateName: String, viewType: String)
```

View type maps to:
```swift
public enum PaywallOpenViewType : String {
    case presented = "presented" // via presentUpsell
    case triggered = "triggered" // shown via SwiftUI view modifier
    case embedded = "embedded" // paywall was manually embedded
}
```

#### Paywall Open Failed
```swift
case paywallOpenFailed(triggerName: String, paywallTemplateName: String)
```

#### Paywall Close
```swift
case paywallClose(triggerName: String, paywallTemplateName: String)
```

#### Paywall Dismissed
```swift
case paywallDismissed(triggerName: String, paywallTemplateName: String, dismissAll: Bool = false)
```

#### Paywall Skipped
```swift
case paywallSkipped(triggerName: String)
```

#### Paywall WebView Rendered
```swift
case paywallWebViewRendered(triggerName: String, paywallTemplateName: String, webviewRenderTimeTakenMS: UInt64? = nil)
```

### Configuration Events

#### Paywalls Download Success
```swift
case paywallsDownloadSuccess(configId: UUID, downloadTimeTakenMS: UInt64? = nil, imagesDownloadTimeTakenMS: UInt64? = nil, fontsDownloadTimeTakenMS: UInt64? = nil, bundleDownloadTimeMS: UInt64? = nil, numAttempts: Int? = nil)
```

#### Paywalls Download Error
```swift
case paywallsDownloadError(error: String, numAttempts: Int? = nil)
```